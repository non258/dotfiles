var ctxtId=0;var ctxtTrId=0;var pre_fav="";chrome.extension.onConnect.addListener(function(port,name){port.onMessage.addListener(function(info,con){var fav_al_prm=localStorage["fav_al"]+"";if(!info){if(pre_fav==fav_al_prm){return}}if(info.ktp&&info.ktp=="op"){window.open(chrome.extension.getURL("options.html"),"_blank");return}pre_fav=fav_al_prm;var fav_al=fav_al_prm.split(",");var fav_act=fav_al[0]||"";var fav_act_ct=fav_al[5]||"";var fav_act_tr=fav_al[8]||"";if(fav_act=="none"){chrome.browserAction.setIcon({path:"icon16_off.png"})}else{chrome.browserAction.setIcon({path:"icon16.png"});fav_act=fav_al[1]||""}var title=fetchQry("%s")||"";title=title.substring(0,Math.min(45,title.length));if(ctxtId==0&&fav_act_ct!="noShow"){var ejTitle="Weblio英和辞典で「"+title+"」を検索";ctxtId=chrome.contextMenus.create({type:"normal",title:ejTitle,contexts:["selection"],onclick:rdtxt})}else if(ctxtId>0&&fav_act_ct=="noShow"){chrome.contextMenus.remove(ctxtId);ctxtId=0}if(ctxtTrId==0&&fav_act_tr!="noShow"){var trTitle="Weblioで「"+title+"」を翻訳";ctxtTrId=chrome.contextMenus.create({type:"normal",title:trTitle,contexts:["selection"],onclick:rdTrtxt})}else if(ctxtTrId>0&&fav_act_tr=="noShow"){chrome.contextMenus.remove(ctxtTrId);ctxtTrId=0}con.postMessage({r_act:fav_act,r_al:fav_al_prm})})});chrome.tabs.onSelectionChanged.addListener(function(tabId){chrome.tabs.get(tabId,function(tab){if(tab.status==="complete"&&/^(https?|file):/.test(tab.url)){chrome.tabs.sendRequest(tabId,{tb:""},function(response){})}})});